{
  "version": "1.0",
  "priority_order": ["P0", "P1", "P2", "P3"],
  "levels": {
    "P0": {
      "label": "Urgence critique",
      "is_urgent": 1,
      "sla_target_minutes": 5,
      "keywords": [
        "incendie",
        "fumée",
        "fumee",
        "flammes",
        "dokhan",
        "dkhan",
        "afia",
        "3afia",
        "gaz",
        "odeur de gaz",
        "suspicion fuite gaz",
        "ri7t lghaz",
        "ri7t lgaz",
        "fuite gaz",
        "inondation majeure",
        "fayadan",
        "gher9at",
        "gherkat",
        "eau qui monte vite",
        "risque électrique",
        "ascenseur bloqué",
        "coincé",
        "m7bouss",
        "m7bousssa",
        "personne à l’intérieur",
        "dakhel",
        "agression",
        "bagarre",
        "violence",
        "menace",
        "mdabza",
        "tferga3",
        "eau monte",
        "personne inconsciente",
        "inconsciente",
        "personne âgée tombée",
        "problème cardiaque",
        "cardiaque",
        "respiration",
        "porte forcée",
        "serrure cassée",
        "respiration difficile",
        "risque electrique"
      ],
      "response_template": "⚠️ Urgence critique détectée. Restez en sécurité. Un agent est alerté immédiatement. Si danger immédiat, appelez les urgences. Merci d’envoyer : résidence/bloc, étage, numéro d’appartement, description courte, et photos/vidéo si possible."
    },
    "P1": {
      "label": "Urgent",
      "is_urgent": 1,
      "sla_target_minutes": 30,      
      "keywords": [
        "panne d’eau",
        "panne eau",
        "coupure eau",
        "ma m9to3",
        "lma m9to3",
        "panne électrique",
        "coupure électrique",
        "dow m9to3",
        "daw m9to3",
        "parties communes",
        "panne electrique parties communes",
        "coupure electrique parties communes",
        "escaliers noirs",
        "porte garage bloquée",
        "garage bloqué",
        "garaj mbloqué",
        "entrées impossible",
        "sorties impossible",
        "mabghach yt7el",
        "accès bloqué",
        "fuite importante",
        "fuite importante mais pas inondation majeure",
        "fuite sérieuse",
        "garage mbloque",
        "Garaj mbeloqué",
        "ascenseur en panne",
        "asansour khaser",
        "camera sécurité en panne",
        "camera panne",
        "personne suspecte",
        "porte garage bloquee",
        "acces garage bloque",
        "camera securite en panne"
      ],
      "response_template": "Nous avons bien reçu votre signalement urgent. Un ticket a été créé et le prestataire est contacté. Merci d’indiquer : résidence/bloc, localisation exacte, depuis quand, et joindre une photo/vidéo si possible."
    },
    "P2": {
      "label": "Maintenance / Nuisance",
      "is_urgent": 0,
      "sla_target_minutes": 240,
      "keywords": [
        "bruit",
        "bruit répétitif",
        "nuisance",
        "nuisance régulière",
        "voisin dérange",
        "voisin dérange souvent",
        "sda3",
        "sda3 kayt3awd",
        "propreté",
        "saleté",
        "mwsekh",
        "escalier mwsekh",
        "droj moskhin",
        "poubelles",
        "poubelles pleines",
        "zbel",
        "stationnement",
        "stationnement abusif",
        "badge",
        "télécommande",
        "telecommande",
        "proprete",
        "salete"
      ],
      "response_template": "Votre demande de maintenance a été enregistrée. Merci de préciser : résidence/bloc, lieu exact, heure/jour (si bruit), et joindre une photo si possible. Nous reviendrons vers vous pour planifier l’intervention."
    },
    "P3": {
      "label": "Administratif",
      "is_urgent": 0,
      "sla_target_minutes": 1440,
      "keywords": [
        "attestation",
        "attestation de résidence",
        "war9a",
        "charges",
        "quittance",
        "facture",
        "paiement",
        "khlass",
        "flouss",
        "règlement",
        "suivi",
        "suivi demande",
        "retard dossier",
        "ma jawbounich",
        "pas de réponse",
        "delai",
        "ch7al khassni nkhless"
      ],
      "response_template": "Demande administrative reçue. Merci de préciser votre résidence/bloc et votre numéro d’appartement (et la référence si disponible). Nous vous répondrons dès que possible avec la procédure et le délai de traitement."
    }
  },
  
  "guardrails": {
    "rule_priority": "P0 first: if any P0 pattern matches, return P0 even if other levels match.",

    "patterns": {
      "P0": [
        {
          "id": "P0_GAS",
          "any": ["gaz", "odeur de gaz", "fuite gaz", "suspicion fuite gaz", "ri7t lghaz", "ri7t lgaz"],
          "explain": "Gaz / odeur de gaz => P0"
        },
        {
          "id": "P0_FIRE",
          "any": ["incendie", "fumee", "flammes", "dokhan", "dkhan", "afia", "3afia"],
          "explain": "Incendie / fumée / flammes => P0"
        },
        {
          "id": "P0_ELEVATOR_TRAPPED",
          "all": ["ascenseur"],
          "any_group": [
            ["bloque", "coince", "m7bouss", "m7boussa"],
            ["personne", "a l'interieur", "dakhel", "dakhla"],
            ["a l'interieur", "a linterieur", "a l interieur", "interieur", "a l'interieur"]
          ],
          "explain": "Ascenseur bloqué + personne à l’intérieur => P0"
        },
        {
          "id": "P0_FLOOD_MAJOR",
          "all": ["inondation"],
          "any": ["majeure", "partout", "eau monte", "risque electrique"],
          "explain": "Inondation majeure / eau monte / partout / risque électrique => P0"
        },
        {
          "id": "P0_VIOLENCE",
          "any": ["agression", "bagarre", "violence", "menace", "mdabza", "tferga3"],
          "explain": "Agression / bagarre => P0"
        },
        {
          "id": "P0_MEDICAL",
          "any": ["inconscient", "personne inconsciente", "ne respire pas", "respiration", "cardiaque", "personne agee tombee"],
          "explain": "Urgence médicale => P0"
        }
      ],
      "P1": [
        {
          "id": "P1_GARAGE_BLOCKED",
          "all": ["garage"],
          "any": ["bloque", "bloquee", "mbloque", "kayt7ellch", "mabghach yt7el", "impossible d'entrer", "impossible d entrer"],
          "explain": "Porte/accès garage bloqué => P1"
        },
        {
          "id": "P1_WATER_RULE",
          "any": ["panne d'eau", "plus d'eau", "coupure d'eau", "ma kaynch lma", "ma kaynach lma", "mouchkil f lma"],
          "explain": "Panne/coupure d’eau => P1"
        },
        {
          "id": "P1_ELECTRIC_SPARKS",
          "any": ["etincelles", "étincelles", "court circuit", "sparks", "tchicha dyal lbar9"],
          "explain": "Étincelles / risque électrique => P1"
        }

      ]

    }
  }

}
